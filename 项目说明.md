# 印章提取与智能比对系统 - 完整项目说明

## 📋 项目概述

本项目是一个基于Flask的Web应用，提供PDF印章检测、提取和智能比对的完整前端解决方案。系统能够自动检测PDF中的红色印章，提取符合尺寸要求的印章图像，并与参考模板进行AI智能比对。

## 🎯 核心功能

### 1. PDF印章检测
- 自动检测PDF第一页中的红色印章
- 计算印章直径（默认40mm±1mm）
- 提取符合条件的印章图像

### 2. 图像处理
- 使用OpenCV进行图像增强
- 自动裁剪印章区域
- 统一调整为正方形（250x250像素）
- 颜色统一为红色

### 3. 模板管理
- 从指定目录加载参考模板
- 支持多种图片格式（PNG, JPG, JPEG, BMP）
- 可视化模板选择界面

### 4. AI智能比对
- 调用视觉模型API进行比对
- 分析文字内容、字体风格、五角星等特征
- 生成详细的比对报告

### 5. PC专业版特色
- **键盘快捷键**: 支持Ctrl+O, Ctrl+D, Ctrl+Enter等
- **拖拽上传**: 支持文件拖拽和粘贴上传
- **大屏优化**: 响应式设计，适配高分辨率显示器
- **流畅动画**: CSS3动画和过渡效果

## 📁 项目结构

```
stamp_webapp/
│
├── 核心程序
│   ├── app.py              # Flask主应用（整合所有功能）
│   ├── config.py           # 配置文件
│   └── requirements.txt    # Python依赖
│
├── 前端文件
│   ├── templates/
│   │   ├── index.html      # 通用版前端页面
│   │   └── index_pc.html   # PC专业版前端页面
│   └── static/
│       ├── js/
│       │   ├── app.js      # 通用版前端逻辑
│       │   └── app_pc.js   # PC版前端逻辑
│       ├── uploads/        # 上传文件存储
│       └── temp/           # 临时文件
│
├── 启动脚本
│   ├── run.bat             # Windows通用版启动
│   ├── run.sh              # Linux/macOS通用版启动
│   ├── run_pc.bat          # Windows PC版启动
│   └── run_pc.sh           # Linux/macOS PC版启动
│
└── 文档
    ├── README.md           # 通用版说明文档
    ├── README_PC.md        # PC版详细文档
    ├── PC版部署指南.md     # PC版部署指南
    ├── 快速部署指南.txt     # 快速入门
    └── 项目说明.md         # 本文档
```

## 🚀 快速启动

### Windows系统

#### 方法1：一键启动（推荐）
```bash
# 双击运行PC版启动脚本
run_pc.bat
```

#### 方法2：命令行启动
```bash
# 安装依赖
pip install -r requirements.txt

# 启动应用
python app.py
```

### Linux/macOS系统

#### 方法1：一键启动（推荐）
```bash
# 赋予执行权限
chmod +x run_pc.sh

# 运行启动脚本
./run_pc.sh
```

#### 方法2：命令行启动
```bash
# 安装依赖
pip3 install -r requirements.txt

# 启动应用
python3 app.py
```

### 访问系统

启动成功后，浏览器会自动打开：
```
http://localhost:5000
```

如果浏览器未自动打开，请手动访问上述地址。

---

## ⚙️ 系统配置

### 1. 模板目录配置

编辑 `app.py` 第12行：
```python
# Windows示例
TEMPLATE_FOLDER = r"C:\印章模板库"

# Linux/macOS示例
TEMPLATE_FOLDER = r"/home/user/templates"

# 网络共享路径示例
TEMPLATE_FOLDER = r"\\server\templates"
```

### 2. 印章尺寸配置

编辑 `app.py` 第16-17行：
```python
# 目标直径(mm)
TARGET_DIAMETER_MM = 40.0

# 容差范围(mm)
TOLERANCE_MM = 1.0
```

### 3. API配置

编辑 `app.py` 第11行：
```python
API_KEY = "your-api-key-here"
```

### 4. 端口配置

编辑 `app.py` 最后一行：
```python
# 默认端口5000
app.run(debug=True, host='0.0.0.0', port=5000)

# 修改为其他端口
app.run(debug=True, host='0.0.0.0', port=8080)
```

---

## ⌨️ 键盘快捷键（PC版）

| 快捷键 | 功能 | 使用场景 |
|--------|------|----------|
| `Ctrl+O` | 打开文件 | 快速选择PDF文件 |
| `Ctrl+D` | 检测印章 | 开始印章检测 |
| `Ctrl+Enter` | 开始比对 | 执行智能比对 |
| `Ctrl+N` | 新建比对 | 清空数据重新开始 |
| `F1` | 帮助 | 显示快捷键列表 |
| `Esc` | 关闭 | 关闭弹窗/隐藏帮助 |

---

## 🎨 界面说明

### PC专业版界面特色

#### 1. 现代化设计
- 渐变背景和卡片式布局
- 圆角设计和阴影效果
- 专业的色彩方案

#### 2. 大屏优化
- 充分利用显示器空间
- 响应式网格布局
- 高分辨率支持

#### 3. 流畅动画
- CSS3过渡效果
- 加载动画
- 页面切换动画

#### 4. 交互增强
- 悬停效果
- 选中状态
- 操作反馈

---

## 📊 性能指标

### 处理速度
- **文件上传**: 取决于文件大小
- **印章检测**: 平均2-3秒
- **图像处理**: 平均1-2秒
- **AI比对**: 平均5-10秒

### 资源占用
- **内存**: 约100-200MB
- **磁盘**: 约50MB（不含模板）
- **网络**: 仅AI比对时需要

### 支持规格
- **文件大小**: 最大16MB
- **文件格式**: PDF
- **图片格式**: PNG, JPG, JPEG, BMP
- **检测尺寸**: 默认40mm±1mm（可配置）

---

## 🔧 技术栈

### 后端
- **Python 3.8+**: 主要编程语言
- **Flask 2.3.3**: Web框架
- **OpenCV**: 图像处理
- **PyMuPDF**: PDF处理
- **NumPy**: 数值计算

### 前端
- **HTML5**: 语义化标签
- **CSS3**: Flexbox/Grid + 动画
- **JavaScript ES6+**: 模块化编程
- **Bootstrap 5**: UI框架

### 外部服务
- **SiliconFlow API**: AI视觉模型
- **Qwen3-VL-32B-Instruct**: 比对模型

---

## 📋 使用流程

### 完整操作流程

```
用户 → 上传PDF → 检测印章 → 选择模板 → AI比对 → 查看结果
  ↓          ↓          ↓          ↓          ↓
选择文件    自动检测    点击选择    调用API    显示报告
拖拽/粘贴   筛选尺寸    模板选择    等待结果    下载图片
```

### 详细步骤

#### 步骤1: 上传PDF
1. 拖拽PDF文件到上传区域
2. 或点击上传区域选择文件
3. 或使用快捷键 `Ctrl+O`
4. 或复制PDF后按 `Ctrl+V` 粘贴

#### 步骤2: 检测印章
1. 点击"开始检测印章"按钮
2. 或按快捷键 `Ctrl+D`
3. 等待系统分析PDF
4. 查看检测到的印章列表

#### 步骤3: 选择模板
1. 点击要检测的印章卡片
2. 从模板库选择参考模板
3. 确认两个都已选中

#### 步骤4: 智能比对
1. 点击"开始智能比对"按钮
2. 或按快捷键 `Ctrl+Enter`
3. 等待AI生成报告
4. 查看详细比对结果

---

## 🛡️ 安全特性

### 文件安全
- 文件类型验证（仅PDF）
- 文件大小限制（16MB）
- 文件名安全检查

### 数据安全
- 临时文件自动清理
- 路径遍历防护
- 敏感信息配置化

### 网络安全
- XSS防护
- CSRF防护
- 输入验证

---

## 🐛 常见问题

### 问题1: Python not found
**解决**: 安装Python 3.8+并添加到PATH

### 问题2: ModuleNotFoundError
**解决**: 执行 `pip install -r requirements.txt`

### 问题3: 模板不显示
**解决**: 检查 `TEMPLATE_FOLDER` 路径是否正确

### 问题4: 印章检测失败
**解决**: 
- 确保PDF第一页有红色印章
- 检查尺寸是否符合要求
- 调整检测参数

### 问题5: AI比对失败
**解决**:
- 检查API密钥
- 确保网络连接
- 查看错误日志

---

## 📈 扩展建议

### 功能扩展
1. **批量处理**: 支持多个PDF同时处理
2. **历史记录**: 保存比对历史
3. **用户管理**: 添加登录功能
4. **报表导出**: 导出PDF/Excel报告

### 性能优化
1. **缓存机制**: 缓存检测结果
2. **异步处理**: 异步执行耗时操作
3. **负载均衡**: 多实例部署
4. **CDN加速**: 静态资源加速

---

## 📞 技术支持

### 文档资源
1. `README.md` - 通用版说明
2. `README_PC.md` - PC版详细说明
3. `PC版部署指南.md` - 部署指南
4. `快速部署指南.txt` - 快速入门

### 自助排查
1. 查看Python控制台输出
2. 查看浏览器控制台错误
3. 检查配置文件
4. 验证文件权限

---

## 📄 版本信息

### 当前版本
- **版本号**: v2.0.0 (PC专业版)
- **发布日期**: 2024年
- **支持平台**: Windows / Linux / macOS

### 版本特性
- ✨ 全新PC端界面
- ⌨️ 键盘快捷键支持
- 📁 优化文件上传
- 🎨 改进视觉效果
- 🚀 提升操作体验

---

## 📜 许可证

本项目仅供学习和内部使用。

---

## 🎉 总结

本项目提供了完整的PDF印章检测和比对解决方案，包含：

1. **后端服务**: Flask + OpenCV + AI API
2. **前端界面**: PC专业版和通用版
3. **启动脚本**: Windows和Linux/macOS
4. **详细文档**: 部署、使用、故障排查

**快速开始**: 运行 `run_pc.bat` 或 `run_pc.sh`，访问 `http://localhost:5000`

**享受高效的印章检测与比对体验！** 🎊
